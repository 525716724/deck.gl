/*! For license information please see 228c412f523d0249194e124c7f14e1aa59ebb736-8b4458e390815c942b00.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{11:function(e,t){},"49Am":function(e,t,r){"use strict";r.d(t,"a",(function(){return Cr}));var n=r("o0o1"),i=r.n(n),a=r("rePB"),o=(r("wcNg"),r("HaE+")),s=r("vuIU"),u=r("dI71"),c=r("0mpS"),l=r("7G5M"),h=r("5VxJ"),f=r("mejf"),d=r("bZ2V"),p=r("ro6J"),y=r("7V6X"),v=r("t1qw"),b=r("oFBv"),m=r("Cdqv");function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=function(e){function t(){return e.apply(this,arguments)||this}Object(u.a)(t,e);var r=t.prototype;return r.getShaders=function(){var t=e.prototype.getShaders.call(this);return t.modules.push(v.a),_(_({},t),{},{vs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-vs\n\n// Scale the model\nuniform float sizeScale;\nuniform bool composeModelMatrix;\nuniform bool u_pickFeatureIds;\n\n// Primitive attributes\nin vec3 positions;\nin vec3 normals;\nin vec3 colors;\nin vec2 texCoords;\nin vec4 uvRegions;\nin vec3 featureIdsPickingColors;\n\n// Instance attributes\nin vec4 instanceColors;\nin vec3 instancePickingColors;\nin mat3 instanceModelMatrix;\n\n// Outputs to fragment shader\nout vec2 vTexCoord;\nout vec3 cameraPosition;\nout vec3 normals_commonspace;\nout vec4 position_commonspace;\nout vec4 vColor;\n\nvoid main(void) {\n  // https://github.com/Esri/i3s-spec/blob/master/docs/1.7/geometryUVRegion.cmn.md\n  vec2 uv = fract(texCoords) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;\n\n  geometry.uv = uv;\n  geometry.uv = texCoords;\n\n  if (u_pickFeatureIds) {\n    geometry.pickingColor = featureIdsPickingColors;\n  } else {\n    geometry.pickingColor = instancePickingColors;\n  }\n\n  #ifdef MODULE_PBR\n    // set PBR data\n    #ifdef HAS_NORMALS\n      pbr_vNormal = project_normal(instanceModelMatrix * normals);\n      geometry.normal = pbr_vNormal;\n    #endif\n\n    #ifdef HAS_UV\n      pbr_vUV = uv;\n    #else\n      pbr_vUV = vec2(0., 0.);\n    #endif\n    geometry.uv = pbr_vUV;\n  #endif\n\n  vTexCoord = uv;\n  cameraPosition = project_uCameraPosition;\n  normals_commonspace = project_normal(instanceModelMatrix * normals);\n  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);\n  geometry.normal = normals_commonspace;\n\n  vec3 pos = (instanceModelMatrix * positions) * sizeScale;\n  vec3 projectedPosition = project_position(positions);\n  position_commonspace = vec4(projectedPosition, 1.0);\n  gl_Position = project_common_position_to_clipspace(position_commonspace);\n\n  geometry.position = position_commonspace;\n\n  #ifdef MODULE_PBR\n    // set PBR data\n    pbr_vPosition = geometry.position.xyz;\n  #endif\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#version 300 es\n#define SHADER_NAME simple-mesh-layer-fs\n\nprecision highp float;\n\nuniform bool hasTexture;\nuniform sampler2D sampler;\nuniform bool flatShading;\nuniform float opacity;\n\nin vec2 vTexCoord;\nin vec3 cameraPosition;\nin vec3 normals_commonspace;\nin vec4 position_commonspace;\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  \n#ifdef MODULE_PBR\n\n  fragColor = vColor * pbr_filterColor(vec4(0));\n  geometry.uv = pbr_vUV;\n  fragColor.a *= opacity;\n\n#else\n\n  geometry.uv = vTexCoord;\n\n  vec3 normal;\n  if (flatShading) {\n\n// NOTE(Tarek): This is necessary because\n// headless.gl reports the extension as\n// available but does not support it in\n// the shader.\n#ifdef DERIVATIVES_AVAILABLE\n    normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n  } else {\n    normal = normals_commonspace;\n  }\n\n  vec4 color = hasTexture ? texture(sampler, vTexCoord) : vColor;\n  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);\n  fragColor = vec4(lightColor, color.a * opacity);\n\n#endif\n\n  DECKGL_FILTER_COLOR(fragColor, geometry);\n}\n"})},r.initializeState=function(){var t=this.props.featureIds;e.prototype.initializeState.call(this),t&&this.state.attributeManager.add({featureIdsPickingColors:{type:c.a.UNSIGNED_BYTE,size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})},r.updateState=function(t){var r=t.props,n=t.oldProps,i=t.changeFlags;e.prototype.updateState.call(this,{props:r,oldProps:n,changeFlags:i}),r.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)},r.draw=function(t){var r=this.props.featureIds;this.state.model&&(this.state.model.setUniforms({u_Camera:this.state.model.getUniforms().project_uCameraPosition,u_pickFeatureIds:Boolean(r)}),e.prototype.draw.call(this,t))},r.getModel=function(e){var t,r=this.props,n=r.id,i=r.pbrMaterial,a=this.parseMaterial(i,e),o=this.getShaders();return(t=e.attributes).COLOR_0||t.colors||(t.colors={constant:!0,value:new Float32Array([1,1,1])}),t.uvRegions||(t.uvRegions={constant:!0,value:new Float32Array([0,0,1,1])}),new b.a(this.context.gl,_(_({},this.getShaders()),{},{id:n,geometry:e,defines:_(_({},o.defines),null==a?void 0:a.defines),parameters:null==a?void 0:a.parameters,isInstanced:!0}))},r.updatePbrMaterialUniforms=function(e){var t=this.state.model;if(t){var r=this.props.mesh,n=this.parseMaterial(e,r);t.setUniforms(n.uniforms)}},r.parseMaterial=function(e,t){var r=Boolean(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return new y.a(this.context.gl,{attributes:{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},material:_({unlit:r},e),pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1})},r.calculateFeatureIdsPickingColors=function(e){for(var t=this.props.featureIds,r=new Uint8ClampedArray(t.length*e.size),n=[],i=0;i<t.length;i++)this.encodePickingColor(t[i],n),r[3*i]=n[0],r[3*i+1]=n[1],r[3*i+2]=n[2];e.value=r},t}(m.a);T.layerName="_MeshLayer",T.defaultProps={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};var O=r("74We"),w=r("p1p/"),S=r("1OyB"),E=r("kh/P"),j=r("SDD5"),A=r("FlnL"),P=r("G+eI"),C=r("DYWF"),k=r("oCaT"),I=r("D430"),R=function e(t,r,n){Object(S.a)(this,e),this.item=t,this.previous=r,this.next=n},x=function(){function e(){Object(S.a)(this,e),this.head=null,this.tail=null,this._length=0}return Object(s.a)(e,[{key:"length",get:function(){return this._length}},{key:"add",value:function(e){var t=new R(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}},{key:"remove",value:function(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}},{key:"splice",value:function(e,t){e!==t&&(this.remove(t),this._insert(e,t))}},{key:"_insert",value:function(e,t){var r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}]),e}();function M(e){return null!=e}var N=function(){function e(){Object(S.a)(this,e),Object(a.a)(this,"_list",void 0),Object(a.a)(this,"_sentinel",void 0),Object(a.a)(this,"_trimTiles",void 0),this._list=new x,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return Object(s.a)(e,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(e){var t=e._cacheNode;M(t)&&this._list.splice(this._sentinel,t)}},{key:"add",value:function(e,t,r){M(t._cacheNode)||(t._cacheNode=this._list.add(t),r&&r(e,t))}},{key:"unloadTile",value:function(e,t,r){var n=t._cacheNode;M(n)&&(this._list.remove(n),t._cacheNode=void 0,r&&r(e,t))}},{key:"unloadTiles",value:function(e,t){var r=this._trimTiles;this._trimTiles=!1;for(var n=this._list,i=1024*e.maximumMemoryUsage*1024,a=this._sentinel,o=n.head;o!==a&&(e.gpuMemoryUsageInBytes>i||r);){var s=o.item;o=o.next,this.unloadTile(e,s,t)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),e}();var U=r("DUak"),L=new j.a,D=new j.a,B=new U.c([new U.e,new U.e,new U.e,new U.e,new U.e,new U.e]);function V(e,t){var r=e.cameraDirection,n=e.cameraUp,i=e.height,a=e.distanceScales.metersPerUnit,o=[e.longitude,e.latitude,0],s=A.a.WGS84.cartographicToCartesian(o,new j.a),u=A.a.WGS84.eastNorthUpToFixedFrame(s),c=e.unprojectPosition(e.cameraPosition),l=A.a.WGS84.cartographicToCartesian(c,new j.a),h=new j.a(u.transformAsVector(new j.a(r).scale(a))).normalize(),f=new j.a(u.transformAsVector(new j.a(n).scale(a))).normalize();return function(e,t){var r=e.getFrustumPlanes(),n=0;for(var i in r){var a=r[i],o=a.normal.dot(e.center);D.copy(a.normal).scale(a.distance-o).add(e.center);var s=e.unprojectPosition(D),u=A.a.WGS84.cartographicToCartesian(s,new j.a);B.planes[n++].fromPointNormal(u,L.copy(t).subtract(u))}}(e,s),{camera:{position:l,direction:h,up:f},viewport:e,height:i,cullingVolume:B,frameNumber:t,sseDenominator:1.15}}var F=new j.a;function z(e){var t=e.halfAxes,r=e.radius,n=e.width,i=e.height;if(t){var a=function(e){e.getColumn(0,F);var t=e.getColumn(1),r=e.getColumn(2);return F.add(t).add(r).len()}(t);return Math.log2(6356752.314245179/a)}return r?Math.log2(6356752.314245179/r):i&&n?(Math.log2(6378137/n)+Math.log2(6378137/i))/2:1}var q=0,G=1,H=3,Y=4,J=5,Q=1,Z=2,W="empty",X="scenegraph",K="pointcloud",$="mesh",ee="I3S",te="TILES3D",re="geometricError",ne=1,ie=r("KQm4"),ae=r("ODXe"),oe=r("yeNo"),se=r("PcVa"),ue=r("T27a");function ce(e){return null!=e}var le=new j.a,he=new j.a,fe=new j.a;function de(e,t,r){if(Object(C.a)(e,"3D Tile: boundingVolume must be defined"),e.box)return function(e,t,r){var n=new j.a(e[0],e[1],e[2]);t.transform(n,n);var i=[];if(10===e.length){var a=e.slice(3,6),o=new se.a;o.fromArray(e,6);var s=new j.a([1,0,0]),u=new j.a([0,1,0]),c=new j.a([0,0,1]);s.transformByQuaternion(o),s.scale(a[0]),u.transformByQuaternion(o),u.scale(a[1]),c.transformByQuaternion(o),c.scale(a[2]),i=[].concat(Object(ie.a)(s.toArray()),Object(ie.a)(u.toArray()),Object(ie.a)(c.toArray()))}else i=[].concat(Object(ie.a)(e.slice(3,6)),Object(ie.a)(e.slice(6,9)),Object(ie.a)(e.slice(9,12)));var l=t.transformAsVector(i.slice(0,3)),h=t.transformAsVector(i.slice(3,6)),f=t.transformAsVector(i.slice(6,9)),d=new ue.a([l[0],l[1],l[2],h[0],h[1],h[2],f[0],f[1],f[2]]);if(ce(r))return r.center=n,r.halfAxes=d,r;return new U.d(n,d)}(e.box,t,r);if(e.region){var n=Object(ae.a)(e.region,6),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],l=A.a.WGS84.cartographicToCartesian([Object(oe.c)(i),Object(oe.c)(s),u],he),h=A.a.WGS84.cartographicToCartesian([Object(oe.c)(o),Object(oe.c)(a),c],fe),f=(new j.a).addVectors(l,h).multiplyScalar(.5),d=(new j.a).subVectors(l,h).len()/2;return pe([f[0],f[1],f[2],d],new E.a)}if(e.sphere)return pe(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function pe(e,t,r){var n=new j.a(e[0],e[1],e[2]);t.transform(n,n);var i=t.getScale(le),a=Math.max(Math.max(i[0],i[1]),i[2]),o=e[3]*a;return ce(r)?(r.center=n,r.radius=o,r):new U.b(n,o)}new j.a,new j.a,new E.a,new j.a,new j.a,new j.a;function ye(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){var r=e.dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return function(e,t){var r=e*t;return 1-Math.exp(-r*r)}(t,r)*n}return 0}var ve=Math.PI/2;function be(e){var t=Object(ae.a)(e,3),r=t[0],n=t[1],i=t[2],a=Object(oe.j)(r),o=Object(oe.j)(n),s=1+i/6378137,u=s*Math.cos(o);return[r=u*Math.cos(a),n=u*Math.sin(a),i=s*Math.sin(o)]}function me(e,t){var r=Object(ae.a)(e,3),n=r[0],i=r[1],a=r[2],o=void 0===a?0:a,s=Object(ae.a)(t,3),u=s[0],c=s[1],l=s[2],h=be([u,c,void 0===l?0:l]),f=be([n,i,o]),d=f[0]-h[0],p=f[1]-h[1],y=f[2]-h[2];return d*d+p*p+y*y}function ge(e,t){var r=t.viewport,n=e.header.mbs[1],i=[e.header.mbs[0],n,e.header.mbs[2]],a=e.header.mbs[3]/6378137,o=me(r.unprojectPosition(r.cameraPosition),i)-a*a;return o<=0?170141175e30:function(e){return e.viewport.projectionMatrix[5]}(t)*a/Math.sqrt(o)*300}var _e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;Object(S.a)(this,e),this._array=new Array(t),this._map=new Map,this._length=t}return Object(s.a)(e,[{key:"length",get:function(){return this._length},set:function(e){this._length=e,e>this._array.length&&(this._array.length=e)}},{key:"values",get:function(){return this._array}},{key:"get",value:function(e){return Object(C.a)(e<this._array.length),this._array[e]}},{key:"set",value:function(e,t){Object(C.a)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}},{key:"delete",value:function(e){var t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(e){if(!this._map.has(e)){var t=this.length++;this._array[t]=e,this._map.set(e,t)}}},{key:"pop",value:function(){var e=this._array[--this.length];return this._map.delete(e),e}},{key:"reserve",value:function(e){Object(C.a)(e>=0),e>this._array.length&&(this._array.length=e)}},{key:"resize",value:function(e){Object(C.a)(e>=0),this.length=e}},{key:"trim",value:function(e){null==e&&(e=this.length),this._array.length=e}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(e){return this._map.has(e)}}]),e}();function Te(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Oe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Oe(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function we(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?we(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ee={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2,updateTransforms:!0,onTraversalEnd:function(){},viewportTraversersMap:{},basePath:""},je=function(){function e(t){Object(S.a)(this,e),Object(a.a)(this,"options",void 0),Object(a.a)(this,"root",void 0),Object(a.a)(this,"requestedTiles",void 0),Object(a.a)(this,"selectedTiles",void 0),Object(a.a)(this,"emptyTiles",void 0),Object(a.a)(this,"_traversalStack",void 0),Object(a.a)(this,"_emptyTraversalStack",void 0),Object(a.a)(this,"_frameNumber",void 0),this.options=Se(Se({},Ee),t),this._traversalStack=new _e,this._emptyTraversalStack=new _e,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}return Object(s.a)(e,[{key:"traverse",value:function(e,t,r){this.root=e,this.options=Se(Se({},this.options),r),this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(e,t){var r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){var n=r.pop(),i=!1;this.canTraverse(n,t)&&(this.updateChildTiles(n,t),i=this.updateAndPushChildren(n,t,r,n.hasRenderContent?n._selectionDepth+1:n._selectionDepth));var a=n.parent,o=Boolean(!a||a._shouldRefine),s=!i;n.hasRenderContent?n.refine===Q?(this.loadTile(n,t),this.selectTile(n,t)):n.refine===Z&&(this.loadTile(n,t),s&&this.selectTile(n,t)):(this.emptyTiles[n.id]=n,this.loadTile(n,t),s&&this.selectTile(n,t)),this.touchTile(n,t),n._shouldRefine=i&&o}this.options.onTraversalEnd(t)}},{key:"updateChildTiles",value:function(e,t){var r,n=Te(e.children);try{for(n.s();!(r=n.n()).done;){var i=r.value;this.updateTile(i,t)}}catch(a){n.e(a)}finally{n.f()}return!0}},{key:"updateAndPushChildren",value:function(e,t,r,n){var i=this.options,a=i.loadSiblings,o=i.skipLevelOfDetail,s=e.children;s.sort(this.compareDistanceToCamera.bind(this));var u,c=e.refine===Z&&e.hasRenderContent&&!o,l=!1,h=!0,f=Te(s);try{for(f.s();!(u=f.n()).done;){var d=u.value;if(d._selectionDepth=n,d.isVisibleAndInRequestVolume?(r.find(d)&&r.delete(d),r.push(d),l=!0):(c||a)&&(this.loadTile(d,t),this.touchTile(d,t)),c){var p=void 0;if(p=!!d._inRequestVolume&&(d.hasRenderContent?d.contentAvailable:this.executeEmptyTraversal(d,t)),!(h=h&&p))return!1}}}catch(y){f.e(y)}finally{f.f()}return l||(h=!1),h}},{key:"updateTile",value:function(e,t){this.updateTileVisibility(e,t)}},{key:"selectTile",value:function(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}},{key:"loadTile",value:function(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}},{key:"touchTile",value:function(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}},{key:"canTraverse",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:!(!n&&!e.isVisibleAndInRequestVolume)&&this.shouldRefine(e,t,r))}},{key:"shouldLoadTile",value:function(e){return e.hasUnloadedContent||e.contentExpired}},{key:"shouldSelectTile",value:function(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(e,t,r){var n=e._screenSpaceError;return r&&(n=e.getScreenSpaceError(t,!0)),n>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(e,t){var r=[];if(this.options.viewportTraversersMap)for(var n in this.options.viewportTraversersMap){this.options.viewportTraversersMap[n]===t.viewport.id&&r.push(n)}else r.push(t.viewport.id);e.updateVisibility(t,r)}},{key:"compareDistanceToCamera",value:function(e,t){return e._distanceToCamera-t._distanceToCamera}},{key:"anyChildrenVisible",value:function(e,t){var r,n=!1,i=Te(e.children);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.updateVisibility(t),n=n||a.isVisibleAndInRequestVolume}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"executeEmptyTraversal",value:function(e,t){var r=!0,n=this._emptyTraversalStack;for(n.push(e);n.length>0&&r;){var i=n.pop();if(this.updateTile(i,t),i.isVisibleAndInRequestVolume||this.loadTile(i,t),this.touchTile(i,t),!i.hasRenderContent&&this.canTraverse(i,t,!1,!0)){var a,o=Te(i.children);try{for(o.s();!(a=o.n()).done;){var s=a.value;n.find(s)&&n.delete(s),n.push(s)}}catch(u){o.e(u)}finally{o.f()}}else i.contentAvailable||(r=!1)}return r}}]),e}();function Ae(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ae(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ce=new j.a;var ke=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";Object(S.a)(this,e),Object(a.a)(this,"tileset",void 0),Object(a.a)(this,"header",void 0),Object(a.a)(this,"id",void 0),Object(a.a)(this,"url",void 0),Object(a.a)(this,"parent",void 0),Object(a.a)(this,"refine",void 0),Object(a.a)(this,"type",void 0),Object(a.a)(this,"contentUrl",void 0),Object(a.a)(this,"lodMetricType",void 0),Object(a.a)(this,"lodMetricValue",void 0),Object(a.a)(this,"boundingVolume",void 0),Object(a.a)(this,"content",void 0),Object(a.a)(this,"contentState",void 0),Object(a.a)(this,"gpuMemoryUsageInBytes",void 0),Object(a.a)(this,"children",void 0),Object(a.a)(this,"depth",void 0),Object(a.a)(this,"viewportIds",void 0),Object(a.a)(this,"transform",void 0),Object(a.a)(this,"userData",void 0),Object(a.a)(this,"computedTransform",void 0),Object(a.a)(this,"hasEmptyContent",void 0),Object(a.a)(this,"hasTilesetContent",void 0),Object(a.a)(this,"traverser",void 0),Object(a.a)(this,"_cacheNode",void 0),Object(a.a)(this,"_frameNumber",void 0),Object(a.a)(this,"_lodJudge",void 0),Object(a.a)(this,"_expireDate",void 0),Object(a.a)(this,"_expiredContent",void 0),Object(a.a)(this,"_shouldRefine",void 0),Object(a.a)(this,"_distanceToCamera",void 0),Object(a.a)(this,"_centerZDepth",void 0),Object(a.a)(this,"_screenSpaceError",void 0),Object(a.a)(this,"_visibilityPlaneMask",void 0),Object(a.a)(this,"_visible",void 0),Object(a.a)(this,"_inRequestVolume",void 0),Object(a.a)(this,"_stackLength",void 0),Object(a.a)(this,"_selectionDepth",void 0),Object(a.a)(this,"_touchedFrame",void 0),Object(a.a)(this,"_visitedFrame",void 0),Object(a.a)(this,"_selectedFrame",void 0),Object(a.a)(this,"_requestedFrame",void 0),Object(a.a)(this,"_priority",void 0),Object(a.a)(this,"_contentBoundingVolume",void 0),Object(a.a)(this,"_viewerRequestVolume",void 0),Object(a.a)(this,"_initialTransform",void 0),this.header=r,this.tileset=t,this.id=i||r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=q,this.gpuMemoryUsageInBytes=0,this.children=[],this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.depth=0,this.viewportIds=[],this.userData={},this._priority=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._screenSpaceError=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this.traverser=new je({}),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._initialTransform=new E.a,this.transform=new E.a,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,Object.seal(this)}var t;return Object(s.a)(e,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return null===this.header}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===H||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===q}},{key:"contentExpired",get:function(){return this.contentState===Y}},{key:"contentFailed",get:function(){return this.contentState===J}},{key:"getScreenSpaceError",value:function(e,t){switch(this.tileset.type){case ee:return ge(this,e);case te:return function(e,t,r){var n=e.tileset,i=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,a=r?i:e.lodMetricValue;if(0===a)return 0;var o=Math.max(e._distanceToCamera,1e-7),s=t.height,u=t.sseDenominator,c=a*s*(n.options.viewDistanceScale||1)/(o*u);return c-=ye(n,o)}(this,e,t);default:throw new Error("Unsupported tileset type")}}},{key:"_getPriority",value:function(){var e=this.tileset._traverser,t=e.options.skipLevelOfDetail,r=this.refine===Q||t;if(r&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===q)return-1;var n=this.parent,i=n&&(!r||0===this._screenSpaceError||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-i,0)}},{key:"loadContent",value:(t=Object(o.a)(i.a.mark((function e(){var t,r,n,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasEmptyContent){e.next=2;break}return e.abrupt("return",!1);case 2:if(!this.content){e.next=4;break}return e.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=G,e.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));case 9:if(t=e.sent){e.next=13;break}return this.contentState=q,e.abrupt("return",!1);case 13:return e.prev=13,r=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,o=Pe(Pe({},this.tileset.loadOptions),{},Object(a.a)({},n.id,Pe(Pe({},this.tileset.loadOptions[n.id]),{},{isTileset:"json"===this.type},this._getLoaderSpecificOptions(n.id)))),e.next=19,Object(w.a)(r,n,o);case 19:if(this.content=e.sent,!this.tileset.options.contentLoader){e.next=23;break}return e.next=23,this.tileset.options.contentLoader(this);case 23:return this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=H,this._onContentLoaded(),e.abrupt("return",!0);case 29:throw e.prev=29,e.t0=e.catch(13),this.contentState=J,e.t0;case 33:return e.prev=33,t.done(),e.finish(33);case 36:case"end":return e.stop()}}),e,this,[[13,29,33,36]])}))),function(){return t.apply(this,arguments)})},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=q,!0}},{key:"updateVisibility",value:function(e,t){if(this._frameNumber!==e.frameNumber){var r=this.parent,n=r?r._visibilityPlaneMask:U.c.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){var i=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==U.c.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}}},{key:"visibility",value:function(e,t){var r=e.cullingVolume,n=this.boundingVolume;return r.computeVisibilityWithPlaneMask(n,t)}},{key:"contentVisibility",value:function(){return!0}},{key:"distanceToTile",value:function(e){var t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(e){var t=e.camera,r=this.boundingVolume;return Ce.subVectors(r.center,t.position),t.direction.dot(Ce)}},{key:"insideViewerRequestVolume",value:function(e){var t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}},{key:"updateExpiration",value:function(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){var e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Y,this._expiredContent=this.content)}}},{key:"extras",get:function(){return this.header.extras}},{key:"_initializeLodMetric",value:function(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(e){this.transform=e.transform?new E.a(e.transform):new E.a;var t=this.parent,r=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new E.a(n).multiplyRight(this.transform);var i=t&&t._initialTransform?t._initialTransform.clone():new E.a;this._initialTransform=new E.a(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}},{key:"_initializeContent",value:function(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=q,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=U.c.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(e){return e||this.parent&&this.parent.refine||Z}},{key:"_isTileset",value:function(){return-1!==this.contentUrl.indexOf(".json")}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}},{key:"_updateBoundingVolume",value:function(e){this.boundingVolume=de(e.boundingVolume,this.computedTransform,this.boundingVolume);var t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=de(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=de(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E.a,t=e.clone().multiplyRight(this.transform),r=!t.equals(this.computedTransform);r&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}},{key:"_getLoaderSpecificOptions",value:function(e){switch(e){case"i3s":return Pe(Pe({},this.tileset.options.i3s),{},{tile:this.header,tileset:this.tileset.tileset,isTileHeader:!1});case"3d-tiles":case"cesium-ion":default:return{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"}}var t}}]),e}(),Ie=r("ReuC"),Re=r("Ji7U"),xe=r("md7G"),Me=r("foSv");function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(Me.a)(e);if(t){var i=Object(Me.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(xe.a)(this,r)}}var Ue=function(e){Object(Re.a)(r,e);var t=Ne(r);function r(){return Object(S.a)(this,r),t.apply(this,arguments)}return Object(s.a)(r,[{key:"compareDistanceToCamera",value:function(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}},{key:"updateTileVisibility",value:function(e,t){if(Object(Ie.a)(Object(Me.a)(r.prototype),"updateTileVisibility",this).call(this,e,t),e.isVisibleAndInRequestVolume){var n=e.children.length>0;if(e.hasTilesetContent&&n){var i=e.children[0];return this.updateTileVisibility(i,t),void(e._visible=i._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))e._visible=!1;else{var a=e.refine===Z,o=e._optimChildrenWithinParent===ne;a&&o&&n&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}}}},{key:"meetsScreenSpaceErrorEarly",value:function(e,t){var r=e.parent;return!(!r||r.hasTilesetContent||r.refine!==Q)&&!this.shouldRefine(e,t,!0)}}]),r}(je),Le=r("JX7q"),De="REQUESTED",Be="COMPLETED",Ve="ERROR",Fe=function(){function e(){Object(S.a)(this,e),Object(a.a)(this,"_statusMap",void 0),this._statusMap={}}return Object(s.a)(e,[{key:"add",value:function(e,t,r,n){var i=this;this._statusMap[t]||(this._statusMap[t]={request:e,callback:r,key:t,frameState:n,status:De},e().then((function(e){i._statusMap[t].status=Be,i._statusMap[t].callback(e,n)})).catch((function(e){i._statusMap[t].status=Ve,r(e)})))}},{key:"update",value:function(e,t){this._statusMap[e]&&(this._statusMap[e].frameState=t)}},{key:"find",value:function(e){return this._statusMap[e]}}]),e}();function ze(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function qe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ze(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ge(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return He(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return He(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ye(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(Me.a)(e);if(t){var i=Object(Me.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(xe.a)(this,r)}}var Je=function(e){Object(Re.a)(n,e);var t,r=Ye(n);function n(e){var t;return Object(S.a)(this,n),t=r.call(this,e),Object(a.a)(Object(Le.a)(t),"_tileManager",void 0),t._tileManager=new Fe,t}return Object(s.a)(n,[{key:"shouldRefine",value:function(e,t){return e._lodJudge=function(e,t){var r=t.viewport,n=r.metersPerPixel,i=e.header.mbs[1],a=e.header.mbs[0],o=e.header.mbs[2],s=e.header.mbs[3],u=r.height,c=r.width,l=r.latitude,h=r.longitude,f=[h,l],d=[a,i,o],p=[h,i],y=[a,l],v=Math.sqrt(u*u+c*c)*n[0],b=.5*u+s/6378137,m=.5*c+s/6378137;if(me(f,d)>v+s/6378137)return"OUT";if(me(f,p)>b)return"OUT";if(me(f,y)>m)return"OUT";if(0===e.lodMetricValue)return"DIG";var g=ge(e,t);return(g*=ve)<.5?"OUT":!e.header.children||g<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}},{key:"updateChildTiles",value:function(e,t){var r,n=this,i=e.header.children||[],a=e.children,o=e.tileset,s=Ge(i);try{var u=function(){var i=r.value,s="".concat(i.id,"-").concat(t.viewport.id),u=a&&a.find((function(e){return e.id===s}));if(u)u&&n.updateTile(u,t);else{var c=function(){return n._loadTile(i.id,o)};n._tileManager.find(s)?n._tileManager.update(s,t):(o.tileset.nodePages&&(c=function(){return o.tileset.nodePagesTile.formTileFromNodePages(i.id)}),n._tileManager.add(c,s,(function(t){return n._onTileLoad(t,e,s)}),t))}};for(s.s();!(r=s.n()).done;)u()}catch(c){s.e(c)}finally{s.f()}return!1}},{key:"_loadTile",value:(t=Object(o.a)(i.a.mark((function e(t,r){var n,a,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.loader,a=r.getTileUrl("".concat(r.url,"/nodes/").concat(t)),o=qe(qe({},r.loadOptions),{},{i3s:qe(qe({},r.loadOptions.i3s),{},{isTileHeader:!0,loadContent:!1})}),e.next=5,Object(w.a)(a,n,o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),function(e,r){return t.apply(this,arguments)})},{key:"_onTileLoad",value:function(e,t,r){var n=new ke(t.tileset,e,t,r);t.children.push(n);var i=this._tileManager.find(n.id).frameState;this.updateTile(n,i),this._frameNumber===i.frameNumber&&this.executeTraversal(n,i)}}]),n}(je);function Qe(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Ze(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ze(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function We(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?We(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):We(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ke={description:"",ellipsoid:A.a.WGS84,modelMatrix:new E.a,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(){},onTraversalComplete:function(e){return e},contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},$e=function(){function e(t,r){Object(S.a)(this,e),Object(a.a)(this,"options",void 0),Object(a.a)(this,"loadOptions",void 0),Object(a.a)(this,"type",void 0),Object(a.a)(this,"tileset",void 0),Object(a.a)(this,"loader",void 0),Object(a.a)(this,"url",void 0),Object(a.a)(this,"basePath",void 0),Object(a.a)(this,"modelMatrix",void 0),Object(a.a)(this,"ellipsoid",void 0),Object(a.a)(this,"lodMetricType",void 0),Object(a.a)(this,"lodMetricValue",void 0),Object(a.a)(this,"refine",void 0),Object(a.a)(this,"root",void 0),Object(a.a)(this,"roots",void 0),Object(a.a)(this,"asset",void 0),Object(a.a)(this,"description",void 0),Object(a.a)(this,"properties",void 0),Object(a.a)(this,"extras",void 0),Object(a.a)(this,"attributions",void 0),Object(a.a)(this,"credits",void 0),Object(a.a)(this,"stats",void 0),Object(a.a)(this,"traverseCounter",void 0),Object(a.a)(this,"geometricError",void 0),Object(a.a)(this,"selectedTiles",void 0),Object(a.a)(this,"cartographicCenter",void 0),Object(a.a)(this,"cartesianCenter",void 0),Object(a.a)(this,"zoom",void 0),Object(a.a)(this,"boundingVolume",void 0),Object(a.a)(this,"gpuMemoryUsageInBytes",void 0),Object(a.a)(this,"dynamicScreenSpaceErrorComputedDensity",void 0),Object(a.a)(this,"_traverser",void 0),Object(a.a)(this,"_cache",void 0),Object(a.a)(this,"_requestScheduler",void 0),Object(a.a)(this,"_frameNumber",void 0),Object(a.a)(this,"_queryParamsString",void 0),Object(a.a)(this,"_queryParams",void 0),Object(a.a)(this,"_extensionsUsed",void 0),Object(a.a)(this,"_tiles",void 0),Object(a.a)(this,"_pendingCount",void 0),Object(a.a)(this,"lastUpdatedVieports",void 0),Object(a.a)(this,"_requestedTiles",void 0),Object(a.a)(this,"_emptyTiles",void 0),Object(a.a)(this,"frameStateData",void 0),Object(a.a)(this,"maximumMemoryUsage",void 0),Object(C.a)(t),this.options=Xe(Xe({},Ke),r),this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||k.a.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this.root=null,this.roots={},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.traverseCounter=0,this.geometricError=0,this._traverser=this._initializeTraverser(),this._cache=new N,this._requestScheduler=new I.a({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this._frameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this.frameStateData={},this.lastUpdatedVieports=null,this._queryParams={},this._queryParamsString="",this.maximumMemoryUsage=this.options.maximumMemoryUsage||32,this.gpuMemoryUsageInBytes=0,this.stats=new P.a({id:this.url}),this._initializeStats(),this._extensionsUsed=void 0,this.dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description||"",this._initializeTileSet(t)}var t;return Object(s.a)(e,[{key:"destroy",value:function(){this._destroy()}},{key:"isLoaded",value:function(){return 0===this._pendingCount&&0!==this._frameNumber}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"frameNumber",get:function(){return this._frameNumber}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=function(e){for(var t=[],r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t.push("".concat(i,"=").concat(e[i]))}switch(t.length){case 0:return"";case 1:return"?".concat(t[0]);default:return"?".concat(t.join("&"))}}(this._queryParams)),this._queryParamsString}},{key:"setProps",value:function(e){this.options=Xe(Xe({},this.options),e)}},{key:"setOptions",value:function(e){this.options=Xe(Xe({},this.options),e)}},{key:"getTileUrl",value:function(e){return e.startsWith("data:")?e:"".concat(e).concat(this.queryParams)}},{key:"hasExtension",value:function(e){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(e)>-1)}},{key:"update",value:function(e){if((!("loadTiles"in this.options)||this.options.loadTiles)&&!(this.traverseCounter>0)){!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e instanceof Array||(e=[e]),this._cache.reset(),this._frameNumber++,this.traverseCounter=e.length;var t,r=[],n=Qe(e);try{for(n.s();!(t=n.n()).done;){var i=t.value.id;this._needTraverse(i)?r.push(i):this.traverseCounter--}}catch(l){n.e(l)}finally{n.f()}var a,o=Qe(e);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=s.id;if(this.roots[u]||(this.roots[u]=this._initializeTileHeaders(this.tileset,null)),r.includes(u)){var c=V(s,this._frameNumber);this._traverser.traverse(this.roots[u],c,this.options)}}}catch(l){o.e(l)}finally{o.f()}}}},{key:"_needTraverse",value:function(e){var t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}},{key:"_onTraversalEnd",value:function(e){var t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});var r=this.frameStateData[t],n=Object.values(this._traverser.selectedTiles);r.selectedTiles=n,r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}},{key:"_updateTiles",value:function(){for(var e in this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[],this.frameStateData){var t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);var r,n=Qe(this.selectedTiles);try{for(n.s();!(r=n.n()).done;){var i=r.value;this._tiles[i.id]=i}}catch(a){n.e(a)}finally{n.f()}this._loadTiles(),this._unloadTiles(),this._updateStats()}},{key:"_tilesChanged",value:function(e,t){if(e.length!==t.length)return!0;var r=new Set(e.map((function(e){return e.id}))),n=new Set(t.map((function(e){return e.id}))),i=e.filter((function(e){return!n.has(e.id)})).length>0;return i=i||t.filter((function(e){return!r.has(e.id)})).length>0}},{key:"_loadTiles",value:function(){var e,t=Qe(this._requestedTiles);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.contentUnloaded&&this._loadTile(r)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(e,t){return e._unloadTile(t)}))}},{key:"_updateStats",value:function(){var e,t=0,r=0,n=Qe(this.selectedTiles);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.contentAvailable&&i.content&&(t++,i.content.pointCount&&(r+=i.content.pointCount))}}catch(a){n.e(a)}finally{n.f()}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=t,this.stats.get("Points").count=r}},{key:"_initializeTileSet",value:function(e){this.root=this._initializeTileHeaders(e,null),this.type===te&&this._initializeCesiumTileset(e),this.type===ee&&this._initializeI3STileset(),this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var e=this.root;Object(C.a)(e);var t=e.boundingVolume.center;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new j.a,void(this.zoom=1);this.cartographicCenter=A.a.WGS84.cartesianToCartographic(t,new j.a),this.cartesianCenter=t,this.zoom=z(e.boundingVolume)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(e,t){var r=new ke(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===te){var n=[];for(n.push(r);n.length>0;){var i=n.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var a,o=Qe(i.header.children||[]);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=new ke(this,s,i);i.children.push(u),u.depth=i.depth+1,n.push(u)}}catch(c){o.e(c)}finally{o.f()}}}return r}},{key:"_initializeTraverser",value:function(){var e;switch(this.type){case te:e=Ue;break;case ee:e=Je;break;default:e=je}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(e){this._destroySubtree(e)}},{key:"_loadTile",value:(t=Object(o.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this._onStartTileLoading(),e.next=4,t.loadContent();case 4:r=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),this._onTileLoadError(t,e.t0);case 10:return e.prev=10,this._onEndTileLoading(),this._onTileLoad(t,r),e.finish(10);case 14:case"end":return e.stop()}}),e,this,[[0,7,10,14]])}))),function(e){return t.apply(this,arguments)})},{key:"_onTileLoadError",value:function(e,t){this.stats.get("Failed Tile Loads").incrementCount();var r=t.message||t.toString(),n=e.url;console.error("A 3D tile failed to load: ".concat(e.url," ").concat(r)),this.options.onTileError(e,r,n)}},{key:"_onTileLoad",value:function(e,t){t&&(e&&e.content&&function(e,t){Object(C.a)(e),Object(C.a)(t);var r=t.rtcCenter,n=t.gltfUpAxis,i=e.computedTransform,a=e.boundingVolume.center,o=new E.a(i);switch(r&&o.translate(r),n){case"Z":break;case"Y":var s=(new E.a).rotateX(Math.PI/2);o=o.multiplyRight(s);break;case"X":var u=(new E.a).rotateY(-Math.PI/2);o=o.multiplyRight(u)}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);var c=new j.a(a);t.cartesianModelMatrix=o,t.cartesianOrigin=c;var l=A.a.WGS84.cartesianToCartographic(c,new j.a),h=A.a.WGS84.eastNorthUpToFixedFrame(c).invert();t.cartographicModelMatrix=h.multiplyRight(o),t.cartographicOrigin=l,t.modelMatrix=t.cartographicModelMatrix}(e,e.content),this._addTileToCache(e),this.options.onTileLoad(e))}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}},{key:"_addTileToCache",value:function(e){this._cache.add(this,e,(function(t){return t._updateCacheStats(e)}))}},{key:"_updateCacheStats",value:function(e){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=e.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(e){this.gpuMemoryUsageInBytes-=e.content&&e.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}},{key:"_destroy",value:function(){var e=[];for(this.root&&e.push(this.root);e.length>0;){var t,r=e.pop(),n=Qe(r.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;e.push(i)}}catch(a){n.e(a)}finally{n.f()}this._destroyTile(r)}this.root=null}},{key:"_destroySubtree",value:function(e){var t=e,r=[];for(r.push(t);r.length>0;){var n,i=Qe((e=r.pop()).children);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(a)}}catch(o){i.e(o)}finally{i.f()}e!==t&&this._destroyTile(e)}t.children=[]}},{key:"_destroyTile",value:function(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}},{key:"_initializeCesiumTileset",value:function(e){if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed,this.extras=e.extras}},{key:"_initializeI3STileset",value:function(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}]),e}();var et={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect"};Object.keys(et);function tt(e,t,r){Object(C.a)(e instanceof ArrayBuffer);var n=new TextDecoder("utf8"),i=new Uint8Array(e,t,r);return n.decode(i)}function rt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new DataView(e);return"".concat(String.fromCharCode(r.getUint8(t+0))).concat(String.fromCharCode(r.getUint8(t+1))).concat(String.fromCharCode(r.getUint8(t+2))).concat(String.fromCharCode(r.getUint8(t+3)))}var nt=r("tCrw");function it(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?it(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var ot,st={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},ut=at(at({},{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6}),st),ct=(ot={},Object(a.a)(ot,st.DOUBLE,Float64Array),Object(a.a)(ot,st.FLOAT,Float32Array),Object(a.a)(ot,st.UNSIGNED_SHORT,Uint16Array),Object(a.a)(ot,st.UNSIGNED_INT,Uint32Array),Object(a.a)(ot,st.UNSIGNED_BYTE,Uint8Array),Object(a.a)(ot,st.BYTE,Int8Array),Object(a.a)(ot,st.SHORT,Int16Array),Object(a.a)(ot,st.INT,Int32Array),ot),lt={DOUBLE:st.DOUBLE,FLOAT:st.FLOAT,UNSIGNED_SHORT:st.UNSIGNED_SHORT,UNSIGNED_INT:st.UNSIGNED_INT,UNSIGNED_BYTE:st.UNSIGNED_BYTE,BYTE:st.BYTE,SHORT:st.SHORT,INT:st.INT},ht=function(){function e(){Object(S.a)(this,e)}return Object(s.a)(e,null,[{key:"fromTypedArray",value:function(e){for(var t in e=ArrayBuffer.isView(e)?e.constructor:e,ct){if(ct[t]===e)return t}throw new Error("Failed to convert GL type")}},{key:"fromName",value:function(e){var t=lt[e];if(!t)throw new Error("Failed to convert GL type");return t}},{key:"getArrayType",value:function(e){switch(e){case st.UNSIGNED_SHORT_5_6_5:case st.UNSIGNED_SHORT_4_4_4_4:case st.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:var t=ct[e];if(!t)throw new Error("Failed to convert GL type");return t}}},{key:"getByteSize",value:function(t){return e.getArrayType(t).BYTES_PER_ELEMENT}},{key:"validate",value:function(t){return Boolean(e.getArrayType(t))}},{key:"createTypedArray",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;void 0===i&&(i=(r.byteLength-n)/e.getByteSize(t));var a=e.getArrayType(t);return new a(r,n,i)}}]),e}(),ft=function(){function e(t,r){Object(S.a)(this,e),this.json=t,this.buffer=r,this.featuresLength=0,this._cachedTypedArrays={}}return Object(s.a)(e,[{key:"getExtension",value:function(e){return this.json.extensions&&this.json.extensions[e]}},{key:"hasProperty",value:function(e){return Boolean(this.json[e])}},{key:"getGlobalProperty",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ut.UNSIGNED_INT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,n.byteOffset):n}},{key:"getPropertyArray",value:function(e,t,r){var n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(t=ht.fromName(n.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,t,n)}},{key:"getProperty",value:function(e,t,r,n,i){var a=this.json[e];if(!a)return a;var o=this.getPropertyArray(e,t,r);if(1===r)return o[n];for(var s=0;s<r;++s)i[s]=o[r*n+s];return i}},{key:"_getTypedArrayFromBinary",value:function(e,t,r,n,i){var a=this._cachedTypedArrays,o=a[e];return o||(o=ht.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+i,n*r),a[e]=o),o}},{key:"_getTypedArrayFromArray",value:function(e,t,r){var n=this._cachedTypedArrays,i=n[e];return i||(i=ht.createTypedArray(t,r),n[e]=i),i}}]),e}(),dt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pt={SCALAR:function(e,t){return e[t]},VEC2:function(e,t){return[e[2*t+0],e[2*t+1]]},VEC3:function(e,t){return[e[3*t+0],e[3*t+1],e[3*t+2]]},VEC4:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT2:function(e,t){return[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]]},MAT3:function(e,t){return[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]]},MAT4:function(e,t){return[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]}},yt={SCALAR:function(e,t,r){t[r]=e},VEC2:function(e,t,r){t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:function(e,t,r){t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:function(e,t,r){t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:function(e,t,r){t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:function(e,t,r){t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};var vt=function(e){return void 0!==e};function bt(e,t,r){if(!t)return null;var n=e.getExtension("3DTILES_batch_table_hierarchy"),i=t.HIERARCHY;return i&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=i,n=i),n?function(e,t){var r,n,i,a,o=e.instancesLength,s=e.classes,u=e.classIds,c=e.parentCounts,l=e.parentIds,h=o;vt(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,i=getBinaryAccessor(u),u=i.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,o));if(vt(c))for(vt(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,i=getBinaryAccessor(c),c=i.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,o)),a=new Uint16Array(o),h=0,r=0;r<o;++r)a[r]=h,h+=c[r];vt(l)&&vt(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,i=getBinaryAccessor(l),l=i.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,h));var f=s.length;for(r=0;r<f;++r){var d=s[r].length,p=s[r].instances,y=getBinaryProperties(d,p,t);s[r].instances=combine(y,p)}var v=new Array(f).fill(0),b=new Uint16Array(o);for(r=0;r<o;++r)n=u[r],b[r]=v[n],++v[n];var m={classes:s,classIds:u,classIndexes:b,parentCounts:c,parentIndexes:a,parentIds:l};return function(e){for(var t=e.classIds.length,r=0;r<t;++r)gt(e,r,stack)}(m),m}(n,r):null}function mt(e,t,r){if(e){var n=e.parentCounts;return e.parentIds?r(e,t):n>0?function(e,t,r){var n=e.classIds,i=e.parentCounts,a=e.parentIds,o=e.parentIndexes,s=n.length,u=scratchVisited;u.length=Math.max(u.length,s);var c=++marker,l=scratchStack;l.length=0,l.push(t);for(;l.length>0;)if(t=l.pop(),u[t]!==c){u[t]=c;var h=r(e,t);if(vt(h))return h;for(var f=i[t],d=o[t],p=0;p<f;++p){var y=a[d+p];y!==t&&l.push(y)}}return null}(e,t,r):function(e,t,r){var n=!0;for(;n;){var i=r(e,t);if(vt(i))return i;var a=e.parentIds[t];n=a!==t,t=a}throw new Error("traverseHierarchySingleParent")}(e,t,r)}}function gt(e,t,r){var n=e.parentCounts,i=e.parentIds,a=e.parentIndexes,o=e.classIds.length;if(vt(i)){assert(t<o,"Parent index ".concat(t," exceeds the total number of instances: ").concat(o)),assert(-1===r.indexOf(t),"Circular dependency detected in the batch table hierarchy."),r.push(t);for(var s=vt(n)?n[t]:1,u=vt(n)?a[t]:t,c=0;c<s;++c){var l=i[u+c];l!==t&&gt(e,l,r)}r.pop(t)}}function _t(e){return null!=e}var Tt=function(e,t){return e},Ot={HIERARCHY:!0,extensions:!0,extras:!0},wt=function(){function e(t,r,n){var i,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};for(var o in Object(S.a)(this,e),Object(C.a)(n>=0),this.json=t||{},this.binary=r,this.featureCount=n,this._extensions=(null===(i=this.json)||void 0===i?void 0:i.extensions)||{},this._properties={},this.json)Ot[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),a["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=bt(this,this.json,this.binary))}return Object(s.a)(e,[{key:"getExtension",value:function(e){return this.json&&this.json.extensions&&this.json.extensions[e]}},{key:"memorySizeInBytes",value:function(){return 0}},{key:"isClass",value:function(e,t){return this._checkBatchId(e),Object(C.a)("string"==typeof t,t),!!this._hierarchy&&_t(mt(this._hierarchy,e,(function(e,r){var n=e.classIds[r];return e.classes[n].name===t})))}},{key:"isExactClass",value:function(e,t){return Object(C.a)("string"==typeof t,t),this.getExactClassName(e)===t}},{key:"getExactClassName",value:function(e){if(this._checkBatchId(e),this._hierarchy){var t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}},{key:"hasProperty",value:function(e,t){return this._checkBatchId(e),Object(C.a)("string"==typeof t,t),_t(this._properties[t])||this._hasPropertyInHierarchy(e,t)}},{key:"getPropertyNames",value:function(e,t){var r;this._checkBatchId(e),(t=_t(t)?t:[]).length=0;var n=Object.keys(this._properties);return(r=t).push.apply(r,Object(ie.a)(n)),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}},{key:"getProperty",value:function(e,t){if(this._checkBatchId(e),Object(C.a)("string"==typeof t,t),this._binaryProperties){var r=this._binaryProperties[t];if(_t(r))return this._getBinaryProperty(r,e)}var n=this._properties[t];if(_t(n))return Tt(n[e]);if(this._hierarchy){var i=this._getHierarchyProperty(e,t);if(_t(i))return i}}},{key:"setProperty",value:function(e,t,r){var n=this.featureCount;if(this._checkBatchId(e),Object(C.a)("string"==typeof t,t),this._binaryProperties){var i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,r)}if(!this._hierarchy||!this._setHierarchyProperty(this,e,t,r)){var a=this._properties[t];_t(a)||(this._properties[t]=new Array(n),a=this._properties[t]),a[e]=Tt(r)}}},{key:"_checkBatchId",value:function(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}},{key:"_getBinaryProperty",value:function(e,t){return e.unpack(e.typedArray,t)}},{key:"_setBinaryProperty",value:function(e,t,r){e.pack(r,e.typedArray,t)}},{key:"_initializeBinaryProperties",value:function(){var e=null;for(var t in this._properties){var r=this._properties[t],n=this._initializeBinaryProperty(t,r);n&&((e=e||{})[t]=n)}return e}},{key:"_initializeBinaryProperty",value:function(e,t){if("byteOffset"in t){var r=t;Object(C.a)(this.binary,"Property ".concat(e," requires a batch table binary.")),Object(C.a)(r.type,"Property ".concat(e," requires a type."));var n=function(e,t,r,n){var i=e.componentType;Object(C.a)(e.componentType);var a="string"==typeof i?ht.fromName(i):i,o=dt[e.type],s=pt[e.type],u=yt[e.type];return r+=e.byteOffset,{values:ht.createTypedArray(a,t,r,o*n),type:a,size:o,unpacker:s,packer:u}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}},{key:"_hasPropertyInHierarchy",value:function(e,t){if(!this._hierarchy)return!1;var r=mt(this._hierarchy,e,(function(e,r){var n=e.classIds[r];return _t(e.classes[n].instances[t])}));return _t(r)}},{key:"_getPropertyNamesInHierarchy",value:function(e,t){mt(this._hierarchy,e,(function(e,r){var n=e.classIds[r],i=e.classes[n].instances;for(var a in i)i.hasOwnProperty(a)&&-1===t.indexOf(a)&&t.push(a)}))}},{key:"_getHierarchyProperty",value:function(e,t){var r=this;return mt(this._hierarchy,e,(function(e,n){var i=e.classIds[n],a=e.classes[i],o=e.classIndexes[n],s=a.instances[t];return _t(s)?_t(s.typedArray)?r._getBinaryProperty(s,o):Tt(s[o]):null}))}},{key:"_setHierarchyProperty",value:function(e,t,r,n){var i=this,a=mt(this._hierarchy,t,(function(e,a){var o=e.classIds[a],s=e.classes[o],u=e.classIndexes[a],c=s.instances[r];return!!_t(c)&&(Object(C.a)(a===t,'Inherited property "'.concat(r,'" is read-only.')),_t(c.typedArray)?i._setBinaryProperty(c,u,n):c[u]=Tt(n),!0)}));return _t(a)}}]),e}();function St(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=4,e.version=n.getUint32(r,!0),r+=4,e.byteLength=n.getUint32(r,!0),r+=4,1!==e.version)throw new Error("3D Tile Version ".concat(e.version," not supported"));return r}function Et(e,t,r){var n,i=new DataView(t);e.header=e.header||{};var a=i.getUint32(r,!0);r+=4;var o=i.getUint32(r,!0);r+=4;var s=i.getUint32(r,!0);r+=4;var u=i.getUint32(r,!0);return r+=4,s>=570425344?(r-=8,n=a,s=o,u=0,a=0,o=0,console.warn("b3dm tile in legacy format.")):u>=570425344&&(r-=4,n=s,s=a,u=o,a=0,o=0,console.warn("b3dm tile in legacy format.")),e.header.featureTableJsonByteLength=a,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=s,e.header.batchTableBinaryByteLength=u,e.header.batchLength=n,r}function jt(e,t,r,n){return r=function(e,t,r,n){var i=e.header,a=i.featureTableJsonByteLength,o=i.featureTableBinaryByteLength,s=i.batchLength;if(e.featureTableJson={BATCH_LENGTH:s||0},a>0){var u=tt(t,r,a);e.featureTableJson=JSON.parse(u)}return r+=a,e.featureTableBinary=new Uint8Array(t,r,o),r+=o}(e,t,r),r=function(e,t,r,n){var i=e.header,a=i.batchTableJsonByteLength,o=i.batchTableBinaryByteLength;if(a>0){var s=tt(t,r,a);e.batchTableJson=JSON.parse(s),r+=a,o>0&&(e.batchTableBinary=new Uint8Array(t,r,o),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=o)}return r}(e,t,r)}function At(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=e>>11&31,n=e>>5&63,i=31&e;return t[0]=r<<3,t[1]=n<<2,t[2]=i<<3,t}function Pt(e,t,r){if(!(t||e&&e.batchIds&&r))return null;var n=e.batchIds,i=e.isRGB565,a=e.pointCount;if(n&&r){for(var o=new Uint8ClampedArray(3*a),s=0;s<a;s++){var u=n[s],c=r.getProperty(u,"dimensions").map((function(e){return 255*e}));o[3*s]=c[0],o[3*s+1]=c[1],o[3*s+2]=c[2]}return{type:ut.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(i){for(var l=new Uint8ClampedArray(3*a),h=0;h<a;h++){var f=At(t[h]);l[3*h]=f[0],l[3*h+1]=f[1],l[3*h+2]=f[2]}return{type:ut.UNSIGNED_BYTE,value:l,size:3,normalized:!0}}return t&&t.length===3*a?{type:ut.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:ut.UNSIGNED_BYTE,value:t,size:4,normalized:!0}}var Ct=r("uJc0");r("V6u+");function kt(e,t){if(!e)throw new Error("math.gl assertion failed. ".concat(t))}new Ct.a,new j.a,new Ct.a,new Ct.a,new Uint8Array(1);function It(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Object(oe.a)(e,0,t)/t*2-1}function Rt(e){return e<0?-1:1}function xt(e,t,r,n){if(kt(n),e<0||e>r||t<0||t>r)throw new Error("x and y must be unsigned normalized integers between 0 and ".concat(r));if(n.x=It(e,r),n.y=It(t,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){var i=n.x;n.x=(1-Math.abs(n.y))*Rt(i),n.y=(1-Math.abs(i))*Rt(n.y)}return n.normalize()}function Mt(e,t,r){return xt(e,t,255,r)}var Nt=new j.a;function Ut(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){for(var r=new j.a,n=new Float32Array(3*e.pointCount),i=0;i<e.pointCount;i++)r.set(t[3*i],t[3*i+1],t[3*i+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,3*i);return n}(e,t)):{type:ut.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Dt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Bt(e,t,r,n,i){return Vt.apply(this,arguments)}function Vt(){return(Vt=Object(o.a)(i.a.mark((function e(t,r,n,a,o){var s,u,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=St(t,r,n),n=Et(t,r,n),n=jt(t,r,n),Ft(t),s=zt(t),u=s.featureTable,c=s.batchTable,e.next=7,Yt(t,u,c,a,o);case 7:return qt(t,u,a),Gt(t,u,c),Ht(t,u),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ft(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function zt(e){var t=new ft(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",ut.FLOAT,3);var n=function(e,t){var r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",ut.UNSIGNED_SHORT,1),e.batchIds)){var n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");var i=e.batchTableJson,a=e.batchTableBinary;r=new wt(i,a,n)}return r}(e,t);return{featureTable:t,batchTable:n}}function qt(e,t,r){if(!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",ut.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){var n=t.getPropertyArray("POSITION_QUANTIZED",ut.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ut.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ut.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=Ut(e,n,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Gt(e,t,r){if(!e.attributes.colors){var n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",ut.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",ut.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",ut.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=Pt(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",ut.UNSIGNED_BYTE,4))}function Ht(e,t){if(!e.attributes.normals){var r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",ut.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",ut.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){for(var r=new Float32Array(3*e.pointsLength),n=0;n<e.pointsLength;n++)Mt(t[2*n],t[2*n+1],Nt),Nt.toArray(r,3*n);return{type:ut.FLOAT,size:2,value:r}}return{type:ut.FLOAT,size:2,value:t}}(e,r)}}function Yt(e,t,r,n,i){return Jt.apply(this,arguments)}function Jt(){return(Jt=Object(o.a)(i.a.mark((function e(t,r,n,a,o){var s,u,c,l,h,f,d,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((l=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"])&&(c=l.properties),!(h=r.getExtension("3DTILES_draco_point_compression"))){e.next=15;break}if(u=h.properties,f=h.byteOffset,d=h.byteLength,u&&Number.isFinite(f)&&d){e.next=9;break}throw new Error("Draco properties, byteOffset, and byteLength must be defined");case 9:s=t.featureTableBinary.slice(f,f+d),t.hasPositions=Number.isFinite(u.POSITION),t.hasColors=Number.isFinite(u.RGB)||Number.isFinite(u.RGBA),t.hasNormals=Number.isFinite(u.NORMAL),t.hasBatchIds=Number.isFinite(u.BATCH_ID),t.isTranslucent=Number.isFinite(u.RGBA);case 15:if(s){e.next=17;break}return e.abrupt("return",!0);case 17:return p={buffer:s,properties:Dt(Dt({},u),c),featureTableProperties:u,batchTableProperties:c,dequantizeInShader:!1},e.next=20,Qt(t,p,a,o);case 20:return e.abrupt("return",e.sent);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qt(e,t,r,n){return Zt.apply(this,arguments)}function Zt(){return(Zt=Object(o.a)(i.a.mark((function e(t,r,n,a){var o,s,u,c,l,h,f,d,p,y,v,b,m,g,_;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.parse,delete(s=Dt(Dt({},n),{},{draco:Dt(Dt({},n.draco),{},{extraAttributes:r.batchTableProperties||{}})}))["3d-tiles"],e.next=5,o(r.buffer,nt.a,s);case 5:if(u=e.sent,c=u.attributes.POSITION&&u.attributes.POSITION.value,l=u.attributes.COLOR_0&&u.attributes.COLOR_0.value,h=u.attributes.NORMAL&&u.attributes.NORMAL.value,f=u.attributes.BATCH_ID&&u.attributes.BATCH_ID.value,d=c&&u.attributes.POSITION.value.quantization,p=h&&u.attributes.NORMAL.value.quantization,d&&(y=u.POSITION.data.quantization,v=y.range,t.quantizedVolumeScale=new j.a(v,v,v),t.quantizedVolumeOffset=new j.a(y.minValues),t.quantizedRange=(1<<y.quantizationBits)-1,t.isQuantizedDraco=!0),p&&(t.octEncodedRange=(1<<u.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0),b={},r.batchTableProperties)for(m=0,g=Object.keys(r.batchTableProperties);m<g.length;m++)_=g[m],u.attributes[_]&&u.attributes[_].value&&(b[_.toLowerCase()]=u.attributes[_].value);t.attributes=Dt({positions:c,colors:Pt(t,l),normals:h,batchIds:f},b);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Wt=r("BCJS"),Xt=r("16Iq"),Kt=0,$t=1;function er(e,t,r,n){e.rotateYtoZ=!0;var i=e.byteOffset+e.byteLength-r;if(0===i)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Object(Xt.c)(t,r,i),e.gltfByteOffset=0,e.gltfByteLength=i,r%4==0||console.warn("".concat(e.type,": embedded glb is not aligned to a 4-byte boundary.")),e.byteOffset+e.byteLength}function tr(e,t,r,n){return rr.apply(this,arguments)}function rr(){return(rr=Object(o.a)(i.a.mark((function e(t,r,n,a){var o,s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n["3d-tiles"]||{},nr(t,r,n),!o.loadGLTF){e.next=16;break}if(s=a.parse,u=a.fetch,!t.gltfUrl){e.next=9;break}return e.next=7,u(t.gltfUrl,n);case 7:t.gltfArrayBuffer=e.sent,t.gltfByteOffset=0;case 9:if(!t.gltfArrayBuffer){e.next=16;break}return e.next=12,s(t.gltfArrayBuffer,Wt.a,n,a);case 12:t.gltf=e.sent,delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nr(e,t,r){switch(t){case Kt:var n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(n);e.gltfUrl=i.replace(/[\s\0]+$/,""),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case $t:break;default:throw new Error("b3dm: Illegal glTF format field")}}function ir(e,t,r,n,i){return ar.apply(this,arguments)}function ar(){return(ar=Object(o.a)(i.a.mark((function e(t,r,n,a,o){var s,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=or(t,r,n,a,o),e.next=3,tr(t,$t,a,o);case 3:return(u=null==t||null===(s=t.gltf)||void 0===s?void 0:s.extensions)&&u.CESIUM_RTC&&(t.rtcCenter=u.CESIUM_RTC.center),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function or(e,t,r,n,i){r=er(e,t,r=jt(e,t,r=Et(e,t,r=St(e,t,r))),n);var a=new ft(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=a.getGlobalProperty("RTC_CENTER",ut.FLOAT,3),r}function sr(e,t,r,n,i){return ur.apply(this,arguments)}function ur(){return(ur=Object(o.a)(i.a.mark((function e(t,r,n,a,o){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=cr(t,r,n,a,o),e.next=3,tr(t,t.gltfFormat,a,o);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cr(e,t,r,n,i){if(r=St(e,t,r),1!==e.version)throw new Error("Instanced 3D Model version ".concat(e.version," is not supported"));r=Et(e,t,r);var a=new DataView(t);if(e.gltfFormat=a.getUint32(r,!0),r=er(e,t,r=jt(e,t,r+=4),n),0===e.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");var o=new ft(e.featureTableJson,e.featureTableBinary),s=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=s,!Number.isFinite(s))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",ut.FLOAT,3);new wt(e.batchTableJson,e.batchTableBinary,s);return function(e,t,r,n){for(var i=[new Array(n),e._batchTable][0],a=new j.a,o=(new j.a,new j.a,new j.a,new ue.a),s=new se.a,u=new j.a,c={},l=new E.a,h=[],f=[],d=new j.a,p=new j.a,y=0;y<n;y++){var v=void 0;if(t.hasProperty("POSITION"))v=t.getProperty("POSITION",ut.FLOAT,3,y,a);else if(t.hasProperty("POSITION_QUANTIZED")){v=t.getProperty("POSITION_QUANTIZED",ut.UNSIGNED_SHORT,3,y,a);var b=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",ut.FLOAT,3,d);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var m=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",ut.FLOAT,3,p);if(!m)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var g=0;g<3;g++)v[g]=v[g]/65535*m[g]+b[g]}if(!v)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");a.copy(v),c.translation=a,e.normalUp=t.getProperty("NORMAL_UP",ut.FLOAT,3,y,h),e.normalRight=t.getProperty("NORMAL_RIGHT",ut.FLOAT,3,y,f);if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",ut.UNSIGNED_SHORT,2,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",ut.UNSIGNED_SHORT,2,f),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(A.a.WGS84.eastNorthUpToFixedFrame(a,l),l.getRotationMatrix3(o)):o.identity()}!1,s.fromMatrix3(o),c.rotation=s,u.set(1,1,1);var _=t.getProperty("SCALE",ut.FLOAT,1,y);Number.isFinite(_)&&u.multiplyByScalar(_);var T=t.getProperty("SCALE_NON_UNIFORM",ut.FLOAT,3,y,h);T&&u.scale(T),c.scale=u;var O=t.getProperty("BATCH_ID",ut.UNSIGNED_SHORT,1,y);void 0===O&&(O=y);var w=(new E.a).fromQuaternion(c.rotation);l.identity(),l.translate(c.translation),l.multiplyRight(w),l.scale(c.scale);var S=l.clone();i[y]={modelMatrix:S,batchId:O}}e.instances=i}(e,o,0,s),r}function lr(e,t,r,n,i,a){return hr.apply(this,arguments)}function hr(){return(hr=Object(o.a)(i.a.mark((function e(t,r,n,a,o,s){var u,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=St(t,r,n),u=new DataView(r),t.tilesLength=u.getUint32(n,!0),n+=4,t.tiles=[];case 5:if(!(t.tiles.length<t.tilesLength&&t.byteLength-n>12)){e.next=13;break}return c={},t.tiles.push(c),e.next=10,s(r,n,a,o,c);case 10:n=e.sent,e.next=5;break;case 13:return e.abrupt("return",n);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function fr(e){return dr.apply(this,arguments)}function dr(){return(dr=Object(o.a)(i.a.mark((function e(t){var r,n,a,o,s=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s.length>1&&void 0!==s[1]?s[1]:0,n=s.length>2?s[2]:void 0,a=s.length>3?s[3]:void 0,(o=s.length>4&&void 0!==s[4]?s[4]:{}).byteOffset=r,o.type=rt(t,r),e.t0=o.type,e.next=e.t0===et.COMPOSITE?9:e.t0===et.BATCHED_3D_MODEL?12:e.t0===et.INSTANCED_3D_MODEL?15:e.t0===et.POINT_CLOUD?18:21;break;case 9:return e.next=11,lr(o,t,r,n,a,fr);case 11:return e.abrupt("return",e.sent);case 12:return e.next=14,ir(o,t,r,n,a);case 14:return e.abrupt("return",e.sent);case 15:return e.next=17,sr(o,t,r,n,a);case 17:return e.abrupt("return",e.sent);case 18:return e.next=20,Bt(o,t,r,n,a);case 20:return e.abrupt("return",e.sent);case 21:throw new Error("3DTileLoader: unknown type ".concat(o.type));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pr(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return yr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yr(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function yr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function vr(e,t){if(e.content){var r=e.content.uri||e.content.url;e.contentUrl="".concat(t.basePath,"/").concat(r)}return e.id=e.contentUrl,e.lodMetricType=re,e.lodMetricValue=e.geometricError,e.transformMatrix=e.transform,e.type=function(e){if(!e.contentUrl)return W;var t=e.contentUrl.split(".").pop();switch(t){case"pnts":return K;case"i3dm":case"b3dm":return X;default:return t}}(e),e.refine=function(e){switch(e){case"REPLACE":case"replace":return Z;case"ADD":case"add":return Q;default:return e}}(e.refine),e}function br(e){var t=e.basePath,r=vr(e.root,e),n=[];for(n.push(r);n.length>0;){var i,a=pr(n.pop().children||[]);try{for(a.s();!(i=a.n()).done;){var o=i.value;vr(o,{basePath:t}),n.push(o)}}catch(s){a.e(s)}finally{a.f()}}return r}var mr={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:"3.0.8",extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:function(e,t,r){return Sr.apply(this,arguments)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};function gr(e){return k.a.dirname(e.url)}function _r(e,t,r){return Tr.apply(this,arguments)}function Tr(){return(Tr=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={content:{featureIds:null}},0,e.next=4,fr(t,0,r,n,a.content);case 4:return e.abrupt("return",a.content);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Or(e,t,r){return wr.apply(this,arguments)}function wr(){return(wr=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=JSON.parse((new TextDecoder).decode(t))).loader=r.loader||mr,a.url=n.url,a.basePath=gr(a),a.root=br(a),a.type=te,a.lodMetricType=re,a.lodMetricValue=a.root.lodMetricValue,e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Sr(){return(Sr=Object(o.a)(i.a.mark((function e(t,r,n){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r["3d-tiles"]||{},!("auto"===a.isTileset?n.url&&-1!==n.url.indexOf(".json"):a.isTileset)){e.next=8;break}return e.next=5,Or(t,r,n);case 5:t=e.sent,e.next=11;break;case 8:return e.next=10,_r(t,r,n);case 10:t=e.sent;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Er(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function jr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Er(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Er(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Ar=[0],Pr={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:null,loader:mr,onTilesetLoad:{type:"function",value:function(e){},compare:!1},onTileLoad:{type:"function",value:function(e){},compare:!1},onTileUnload:{type:"function",value:function(e){},compare:!1},onTileError:{type:"function",value:function(e,t,r){},compare:!1},_getMeshColor:{type:"function",value:function(e){return[255,255,255]},compare:!1}},Cr=function(e){function t(){return e.apply(this,arguments)||this}Object(u.a)(t,e);var r=t.prototype;return r.initializeState=function(){"onTileLoadFail"in this.props&&O.a.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}},r.shouldUpdateState=function(e){return e.changeFlags.somethingChanged},r.updateState=function(e){var t=e.props,r=e.oldProps,n=e.changeFlags;if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){var i=this.state.activeViewports;Object.keys(i).length&&(this._updateTileset(i),this.state.lastUpdatedViewports=i,this.state.activeViewports={})}if(n.propsChanged){var a=this.state.layerMap;for(var o in a)a[o].needsUpdate=!0}},r.activateViewport=function(e){var t=this.state,r=t.activeViewports,n=t.lastUpdatedViewports;this.internalState.viewport=e,r[e.id]=e;var i=null==n?void 0:n[e.id];i&&e.equals(i)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())},r.getPickingInfo=function(e){var t=e.info,r=e.sourceLayer,n=this.state.layerMap,i=r&&r.id;if(i){var a=i.substring(this.id.length+1),o=a.substring(a.indexOf("-")+1);t.object=n[o]&&n[o].tile}return t},r.filterSubLayer=function(e){var t=e.layer,r=e.viewport,n=t.props.tile,i=r.id;return n.selected&&n.viewportIds.includes(i)},r._updateAutoHighlight=function(e){e.sourceLayer&&e.sourceLayer.updateAutoHighlight(e)},r._loadTileset=function(){var e=Object(o.a)(i.a.mark((function e(t){var r,n,a,o,s,u,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props.loadOptions,n=void 0===r?{}:r,a=this.props.loader||this.props.loaders,Array.isArray(a)&&(a=a[0]),o={loadOptions:jr({},n)},!a.preload){e.next=10;break}return e.next=7,a.preload(t,n);case 7:(s=e.sent).headers&&(o.loadOptions.fetch=jr(jr({},o.loadOptions.fetch),{},{headers:s.headers})),Object.assign(o,s);case 10:return e.next=12,Object(w.a)(t,a,o.loadOptions);case 12:u=e.sent,c=new $e(u,jr({onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileLoadFail:this.props.onTileError},o)),this.setState({tileset3d:c,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(c);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),r._onTileLoad=function(e){var t=this.state.lastUpdatedViewports;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()},r._onTileUnload=function(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)},r._updateTileset=function(e){var t=this.state.tileset3d,r=this.context.timeline,n=Object.keys(e).length;if(r&&n&&t){var i=t.update(Object.values(e));this.state.frameNumber!==i&&this.setState({frameNumber:i})}},r._getSubLayer=function(e,t){if(!e.content)return null;switch(e.type){case K:return this._makePointCloudLayer(e,t);case X:return this._make3DModelLayer(e,t);case $:return this._makeSimpleMeshLayer(e,t);default:throw new Error("Tile3DLayer: Failed to render layer of type "+e.content.type)}},r._makePointCloudLayer=function(e,t){var r=e.content,n=r.attributes,i=r.pointCount,a=r.constantRGBA,o=r.cartographicOrigin,s=r.modelMatrix,u=n.positions,c=n.normals,l=n.colors;if(!u)return null;var f=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:u,NORMAL:c,COLOR_0:l}},p=this.props,y=p.pointSize,v=p.getPointColor;return new(this.getSubLayerClass("pointcloud",d.a))({pointSize:y},this.getSubLayerProps({id:"pointcloud"}),{id:this.id+"-pointcloud-"+e.id,tile:e,data:f,coordinateSystem:h.a.METER_OFFSETS,coordinateOrigin:o,modelMatrix:s,getColor:a||v,_offset:0})},r._make3DModelLayer=function(e){var t=e.content,r=t.gltf,n=t.instances,i=t.cartographicOrigin,a=t.modelMatrix;return new(this.getSubLayerClass("scenegraph",p.a))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:this.id+"-scenegraph-"+e.id,tile:e,data:n||Ar,scenegraph:r,coordinateSystem:h.a.METER_OFFSETS,coordinateOrigin:i,modelMatrix:a,getTransformMatrix:function(e){return e.modelMatrix},getPosition:[0,0,0],_offset:0})},r._makeSimpleMeshLayer=function(e,t){var r=e.content,n=r.attributes,i=r.indices,a=r.modelMatrix,o=r.cartographicOrigin,s=r.material,u=r.featureIds,f=this.props._getMeshColor,d=t&&t.props.mesh||new l.a({drawMode:c.a.TRIANGLES,attributes:kr(n),indices:i});return new(this.getSubLayerClass("mesh",T))(this.getSubLayerProps({id:"mesh"}),{id:this.id+"-mesh-"+e.id,tile:e,mesh:d,data:Ar,getColor:f(e),pbrMaterial:s,modelMatrix:a,coordinateOrigin:o,coordinateSystem:h.a.METER_OFFSETS,featureIds:u,_offset:0})},r.renderLayers=function(){var e=this,t=this.state,r=t.tileset3d,n=t.layerMap;return r?r.tiles.map((function(t){var r=n[t.id]=n[t.id]||{tile:t},i=r.layer;return t.selected&&(i?r.needsUpdate&&(i=e._getSubLayer(t,i),r.needsUpdate=!1):i=e._getSubLayer(t)),r.layer=i,i})).filter(Boolean):null},Object(s.a)(t,[{key:"isLoaded",get:function(){var e=this.state.tileset3d;return e&&e.isLoaded()}}]),t}(f.a);function kr(e){var t={};return t.positions=jr(jr({},e.positions),{},{value:new Float32Array(e.positions.value)}),e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}Cr.layerName="Tile3DLayer",Cr.defaultProps=Pr},"49sm":function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},FlnL:function(e,t,r){"use strict";r.d(t,"a",(function(){return U}));var n=r("ODXe"),i=r("1OyB"),a=r("vuIU"),o=r("SDD5"),s=r("2plT"),u=r("V6u+"),c=r("kh/P"),l=r("yeNo"),h=r("MTwu"),f=(Math.max(6378137,6378137,6356752.314245179),function(e){return e}),d=new o.a;function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;return Object(l.f)(e)?(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]):"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z),t}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;return p(e,t,l.b._cartographicRadians?f:l.j)}function v(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f;return Object(l.f)(t)?(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]):"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]),t}function b(e,t){return v(e,t,l.b._cartographicRadians?f:l.i)}var m=new o.a,g=new o.a,_=new o.a;var T=new o.a,O={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},w={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},S={east:new o.a,north:new o.a,up:new o.a,west:new o.a,south:new o.a,down:new o.a},E=new o.a,j=new o.a,A=new o.a;function P(e,t,r,n,i,a){var o,u,c,h=O[t]&&O[t][r];Object(s.a)(h&&(!n||n===h));var f=T.copy(i);if(Object(l.d)(f.x,0,1e-14)&&Object(l.d)(f.y,0,1e-14)){var d=Math.sign(f.z);o=E.fromArray(w[t]),"east"!==t&&"west"!==t&&o.scale(d),u=j.fromArray(w[r]),"east"!==r&&"west"!==r&&u.scale(d),c=A.fromArray(w[n]),"east"!==n&&"west"!==n&&c.scale(d)}else{var p=S.up,y=S.east,v=S.north;y.set(-f.y,f.x,0).normalize(),e.geodeticSurfaceNormal(f,p),v.copy(p).cross(y);var b=S.west,m=S.south;S.down.copy(p).scale(-1),b.copy(y).scale(-1),m.copy(v).scale(-1),o=S[t],u=S[r],c=S[n]}return a[0]=o.x,a[1]=o.y,a[2]=o.z,a[3]=0,a[4]=u.x,a[5]=u.y,a[6]=u.z,a[7]=0,a[8]=c.x,a[9]=c.y,a[10]=c.z,a[11]=0,a[12]=f.x,a[13]=f.y,a[14]=f.z,a[15]=1,a}var C,k=new o.a,I=new o.a,R=new o.a,x=new o.a,M=new o.a,N=new o.a,U=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(i.a)(this,e),Object(s.a)(t>=0),Object(s.a)(r>=0),Object(s.a)(n>=0),this.radii=new o.a(t,r,n),this.radiiSquared=new o.a(t*t,r*r,n*n),this.radiiToTheFourth=new o.a(t*t*t*t,r*r*r*r,n*n*n*n),this.oneOverRadii=new o.a(0===t?0:1/t,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new o.a(0===t?0:1/(t*t),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(t,r,n),this.maximumRadius=Math.max(t,r,n),this.centerToleranceSquared=u.a.EPSILON1,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return Object(a.a)(e,[{key:"equals",value:function(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=I,i=R,a=Object(n.a)(e,3),o=a[2];this.geodeticSurfaceNormalCartographic(e,r),i.copy(this.radiiSquared).scale(r);var s=Math.sqrt(r.dot(i));return i.scale(1/s),r.scale(o),i.add(r),i.to(t)}},{key:"cartesianToCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];N.from(e);var r=this.scaleToGeodeticSurface(N,x);if(r){var n=this.geodeticSurfaceNormal(r,I),i=M;i.copy(N).subtract(r);var a=Math.atan2(n.y,n.x),o=Math.asin(n.z),s=Math.sign(h.e(i,N))*h.h(i);return b([a,o,s],t)}}},{key:"eastNorthUpToFixedFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new c.a;return P(this,"east","north","up",e,t)}},{key:"localFrameToFixedFrame",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new c.a;return P(this,e,t,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return k.from(e).normalize().to(t)}},{key:"geodeticSurfaceNormalCartographic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=y(e),n=r[0],i=r[1],a=Math.cos(i);return k.set(a*Math.cos(n),a*Math.sin(n),Math.sin(i)).normalize(),k.to(t)}},{key:"geodeticSurfaceNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return k.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}},{key:"scaleToGeodeticSurface",value:function(e,t){return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new o.a,n=t.oneOverRadii,i=t.oneOverRadiiSquared,a=t.centerToleranceSquared;m.from(e);var s=e.x,c=e.y,l=e.z,h=n.x,f=n.y,d=n.z,p=s*s*h*h,y=c*c*f*f,v=l*l*d*d,b=p+y+v,T=Math.sqrt(1/b);if(Number.isFinite(T)){var O=g;if(O.copy(e).scale(T),b<a)return O.to(r);var w=i.x,S=i.y,E=i.z,j=_;j.set(O.x*w*2,O.y*S*2,O.z*E*2);var A,P,C,k,I=(1-T)*e.len()/(.5*j.len()),R=0;do{var x=(A=1/(1+(I-=R)*w))*A,M=(P=1/(1+I*S))*P,N=(C=1/(1+I*E))*C,U=x*A,L=M*P,D=N*C,B=p*U*w+y*L*S+v*D*E,V=-2*B;R=(k=p*x+y*M+v*N-1)/V}while(Math.abs(k)>u.a.EPSILON12);return m.scale([A,P,C]).to(r)}}(e,this,t)}},{key:"scaleToGeocentricSurface",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];x.from(e);var r=x.x,n=x.y,i=x.z,a=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*a.x+n*n*a.y+i*i*a.z);return x.multiplyScalar(o).to(t)}},{key:"transformPositionToScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return x.from(e).scale(this.oneOverRadii).to(t)}},{key:"transformPositionFromScaledSpace",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return x.from(e).scale(this.radii).to(t)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];Object(s.a)(Object(l.d)(this.radii.x,this.radii.y,u.a.EPSILON15)),Object(s.a)(this.radii.z>0),x.from(e);var n=x.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-t))return x.set(0,0,n).to(r)}}],[{key:"WGS84",get:function(){return C=C||new e(6378137,6378137,6356752.314245179)}}]),e}()},H7XF:function(e,t,r){"use strict";t.byteLength=function(e){var t=c(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,n=c(e),o=n[0],s=n[1],u=new a(function(e,t,r){return 3*(t+r)/4-r}(0,o,s)),l=0,h=s>0?o-4:o;for(r=0;r<h;r+=4)t=i[e.charCodeAt(r)]<<18|i[e.charCodeAt(r+1)]<<12|i[e.charCodeAt(r+2)]<<6|i[e.charCodeAt(r+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===s&&(t=i[e.charCodeAt(r)]<<2|i[e.charCodeAt(r+1)]>>4,u[l++]=255&t);1===s&&(t=i[e.charCodeAt(r)]<<10|i[e.charCodeAt(r+1)]<<4|i[e.charCodeAt(r+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],o=0,s=r-i;o<s;o+=16383)a.push(l(e,o,o+16383>s?s:o+16383));1===i?(t=e[r-1],a.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],a.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return a.join("")};for(var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)n[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function l(e,t,r){for(var i,a,o=[],s=t;s<r;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(a=i)>>18&63]+n[a>>12&63]+n[a>>6&63]+n[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},HDXh:function(e,t,r){"use strict";(function(e){var n=r("H7XF"),i=r("kVK+"),a=r("49sm");function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,r)}function c(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=f(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,r),i=(e=s(e,n)).write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(u.isBuffer(t)){var r=0|d(t.length);return 0===(e=s(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?s(e,0):f(e,t);if("Buffer"===t.type&&a(t.data))return f(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=s(e,t<0?0:0|d(t)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function f(e,t){var r=t.length<0?0:0|d(t.length);e=s(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function d(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return F(e).length;default:if(n)return V(e).length;t=(""+t).toLowerCase(),n=!0}}function y(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return j(this,t,r);case"ascii":return A(this,t,r);case"latin1":case"binary":return P(this,t,r);case"base64":return E(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function b(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=u.from(t,n)),u.isBuffer(t))return 0===t.length?-1:m(e,t,r,n,i);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):m(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function m(e,t,r,n,i){var a,o=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,r/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=r;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(r+u>s&&(r=s-u),a=r;a>=0;a--){for(var h=!0,f=0;f<u;f++)if(c(e,a+f)!==c(t,f)){h=!1;break}if(h)return a}return-1}function g(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[r+o]=s}return o}function _(e,t,r,n){return z(V(t,e.length-r),e,r,n)}function T(e,t,r,n){return z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function O(e,t,r,n){return T(e,t,r,n)}function w(e,t,r,n){return z(F(t),e,r,n)}function S(e,t,r,n){return z(function(e,t){for(var r,n,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)r=e.charCodeAt(o),n=r>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function E(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function j(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,o,s,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:128==(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128==(192&a)&&128==(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,r){return c(null,e,t,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,r){return function(e,t,r,n){return l(t),t<=0?s(e,t):void 0!==r?"string"==typeof n?s(e,t).fill(r,n):s(e,t).fill(r):s(e,t)}(null,e,t,r)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=u.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?j(this,0,e):y.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,n,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(n,i),l=e.slice(t,r),h=0;h<s;++h)if(c[h]!==l[h]){a=c[h],o=l[h];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return b(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return b(this,e,t,r,!1)},u.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return g(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":return T(this,e,t,r);case"latin1":case"binary":return O(this,e,t,r);case"base64":return w(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function P(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=B(e[a]);return i}function k(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function I(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,r,n,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function x(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-r,2);i<a;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function M(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-r,4);i<a;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function N(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(e,t,r,n,a){return a||N(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function L(e,t,r,n,a){return a||N(e,0,r,8),i.write(e,t,r,n,52,8),r+8}u.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;r=new u(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+e]}return r},u.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},u.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},u.prototype.readUInt8=function(e,t){return t||I(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||I(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||I(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||I(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||I(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||I(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||I(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||I(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(e,t){t||I(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(e,t){return t||I(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||I(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||I(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||I(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||R(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):M(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<r&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},u.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);R(this,e,t,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):x(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):x(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):M(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):M(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,r){return U(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return U(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return L(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return L(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,a=n-r;if(this===e&&r<t&&t<n)for(i=a-1;i>=0;--i)e[i+t]=this[i+r];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+a),t);return a},u.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var o=u.isBuffer(e)?e:V(new u(e,n).toString()),s=o.length;for(a=0;a<r-t;++a)this[a+t]=o[a%s]}return this};var D=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],o=0;o<n;++o){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function F(e){return n.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function z(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}}).call(this,r("yLpj"))},"kVK+":function(e,t){t.read=function(e,t,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,h=r?i-1:0,f=r?-1:1,d=e[t+h];for(h+=f,a=d&(1<<-l)-1,d>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=f,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=n;l>0;o=256*o+e[t+h],h+=f,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),a-=c}return(d?-1:1)*o*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,p=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+d]=255&s,d+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[r+d]=255&o,d+=p,o/=256,c-=8);e[r+d-p]|=128*y}},oCaT:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n={};function i(e){var t=e&&e.lastIndexOf("/");return t>=0?e.substr(0,t):""}function a(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n="/";return(t=t.map((function(e,r){return r&&(e=e.replace(new RegExp("^".concat(n)),"")),r!==t.length-1&&(e=e.replace(new RegExp("".concat(n,"$")),"")),e}))).join(n)}r.r(n),r.d(n,"dirname",(function(){return i})),r.d(n,"join",(function(){return a}));r(11)},uJc0:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var n=r("1OyB"),i=r("vuIU"),a=r("Ji7U"),o=r("md7G"),s=r("foSv"),u=r("HHP4"),c=r("yeNo"),l=r("fOPP"),h=r("umh7"),f=r("vtVt");function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(s.a)(e);if(t){var i=Object(s.a)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Object(o.a)(this,r)}}var p=function(e){Object(a.a)(r,e);var t=d(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(n.a)(this,r),e=t.call(this,2),Object(c.f)(i)&&1===arguments.length?e.copy(i):(c.b.debug&&(Object(l.a)(i),Object(l.a)(a)),e[0]=i,e[1]=a),e}return Object(i.a)(r,[{key:"set",value:function(e,t){return this[0]=e,this[1]=t,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this.check()}},{key:"fromObject",value:function(e){return c.b.debug&&(Object(l.a)(e.x),Object(l.a)(e.y)),this[0]=e.x,this[1]=e.y,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e}},{key:"ELEMENTS",get:function(){return 2}},{key:"horizontalAngle",value:function(){return Math.atan2(this.y,this.x)}},{key:"verticalAngle",value:function(){return Math.atan2(this.x,this.y)}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return h.j(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return Object(f.a)(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return h.i(this,this,e),this.check()}},{key:"transformByMatrix2x3",value:function(e){return h.h(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return h.g(this,this,e),this.check()}}]),r}(u.a)}}]);